<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="icon" href="images/ship.png" type="image/x-icon">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Sen:wght@400;700&display=swap" rel="stylesheet">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cruise Ship</title>
    <link rel="stylesheet" href="/css/normalize.css">
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <div class="header">
        <div class="header-column">
            <form>
                <label>Add Ports</label><br></br>
                <input type="text" id="newPortName" placeholder="....type a port name here"><br></br>
                <button type="button" class="btn" id="addPort">add</button>
                <button type="button" class="btn" id="reloadPage">Reset itinerary</button>
            </form>
        </div>
        <div class="header-column">
            <div>
            <p id="port-instructions">Please enter three ports</p>
            <ul id="port-list"></ul>
            </div>
            </div>
        </div>
    <div id="headsUpBoard">Itinerary:</div>
    <div id="mainContainer">
    <div id="viewport">
        <div id="ports"></div>
        <div id="portNames"></div>
        <div id = "ship"></div>
    </div>
        <button class="btn" id="sailbutton" disabled>Sail</button>
    </div>
    <script src="src/Itinerary.js"></script>
    <script src="src/Ship.js"></script>
    <script src="src/Port.js"></script>
    <script src="src/Controller.js"></script>
<script>
    const maxPorts = 3;

const itinerary = new Itinerary([]);
const addPortButton = document.querySelector("#addPort");

let listIsAdded = false;

function showUserPorts(port) {
  const portInstructions = document.querySelector("#port-instructions");
  const portList = document.querySelector("#port-list");

  const ul = portList.querySelector("ul") || document.createElement("ul");

  const li = document.createElement("li");
  li.textContent = `Port: ${port.toUpperCase()}`;
  ul.appendChild(li);

  portList.appendChild(ul);

  const remainingPorts = maxPorts - itinerary.ports.length;
  if (remainingPorts > 0) {
    portInstructions.textContent = `Please enter ${remainingPorts} more ${remainingPorts === 1 ? "port" : "ports"}.`;
    sailButton.disabled = true;
  } else {
    portInstructions.textContent = "All ports have been entered, press sail to depart";
    const ship = new Ship(itinerary);
    const controller = new Controller(ship);
    controller.renderPorts(itinerary.ports);
    controller.renderShip();
    const sailButton = document.querySelector("#sailbutton");
    sailButton.disabled = false;
  }
}

addPortButton.addEventListener("click", function(event) {
  const newPort = document.querySelector("#newPortName");
  const headsUpBoard = document.querySelector("#headsUpBoard");
  if (newPort.value) {
    const port = new Port(newPort.value);
    itinerary.ports.push(port);
    console.log(itinerary.ports)
    const delimiter = itinerary.ports.length === maxPorts ? "." : ", ";
    headsUpBoard.innerHTML += `${port.name.toUpperCase()}${delimiter}`;
    showUserPorts(newPort.value);
    newPort.value = "";
  } else {
    alert("Please enter a port name and press add");
  }
  event.preventDefault();
}, false);

const sailButton = document.querySelector("#sailbutton");
sailButton.addEventListener("click", function(event) {
  if (itinerary.ports.length < maxPorts) {
    alert(`${maxPorts - itinerary.ports.length} additional ports are required`);
  } else {
    const ship = new Ship(itinerary);
    const controller = new Controller(ship);
    controller.setSail();
    sailButton.disabled = true;
  }
  event.preventDefault();
}, false);

const reloadPageButton = document.querySelector("#reloadPage");
reloadPageButton.addEventListener("click", () => { location.reload(); });

</script>
</body>

</html>